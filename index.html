<!-- 📁 index.html (전체 교체) -->
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ASK ANYTHING</title>
    <link rel="stylesheet" href="style.css">
    <!-- PDF 라이브러리 추가 -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body>
    <div class="app-container">
        <!-- 전역 음악 컨트롤 -->
        <div id="global-music-control" class="music-control" aria-label="Global music control">
            <button id="music-btn" class="music-button" aria-haspopup="true" aria-expanded="false">
                <span class="music-icon" aria-hidden="true">🎵</span>
                <span class="music-label">Music</span>
            </button>
            <div id="music-slider-container" class="music-popover" role="dialog" aria-label="Music toggle">
                <label class="switch">
                    <input id="music-toggle" type="checkbox" aria-label="Toggle music" />
                    <span class="slider" aria-hidden="true"></span>
                    <span class="switch-text"><span class="on">ON</span><span class="off">OFF</span></span>
                </label>
            </div>
        </div>
        
        <!-- 1. 메인 시작 화면 -->
        <div id="main-screen" class="screen">
            <!-- 제목과 버튼을 감싸는 새로운 컨테이너를 만듭니다. -->
            <div class="title-container">
                <h1 data-i18n-key="mainTitle">ASK ANYTHING</h1>
                
                <div class="lang-switcher-main">
                    <button class="lang-button-small" id="lang-button">KO</button>
                    <ul class="lang-menu-small" id="lang-menu">
                        <!-- JavaScript가 동적으로 채울 예정 -->
                    </ul>
                </div>
            </div>
            
            <div id="main-shuffle-area">
                <img src="images/card_back.png" alt="카드 뒷면" class="card-back-static">
            </div>
        </div>

        <!-- 2. 질문 방식 선택 -->
        <div id="question-dialog-screen" class="screen">
            <h2 data-i18n-key="questionDialogTitle">질문을 어떻게 하시겠어요?</h2>
            <div class="question-method-buttons">
                <button id="direct-input-btn" data-i18n-key="directInput">직접입력</button>
                <div class="fortune-dropdown">
                    <button id="fortune-select-btn" data-i18n-key="fortuneSelect">운세 선택</button>
                    <!-- 👇 JavaScript가 동적으로 채울 수 있도록 비워둡니다. -->
                    <ul id="fortune-menu" class="fortune-menu"></ul>
                </div>
                <button id="mind-question-btn" data-i18n-key="mindQuestion">마음속으로 질문하기</button>
            </div>
        </div>
        
        <!-- 3. 직접 질문 입력 -->
        <div id="custom-question-screen" class="screen">
            <h2 data-i18n-key="customQuestionTitle">질문을 직접 입력해주세요</h2>
            <textarea id="question-input" data-i18n-placeholder="questionPlaceholder"></textarea>
            <div class="navigation-buttons">
                <button id="back-to-dialog-btn" data-i18n-key="backButton">이전</button>
                <button id="submit-question-btn" data-i18n-key="nextButton">다음</button>
            </div>
        </div>

        <!-- 4. MBTI 입력/검사 선택 -->
        <div id="mbti-entry-screen" class="screen">
            <h2 data-i18n-key="mbtiInputTitle">MBTI를 입력해주세요</h2>
            <p data-i18n-key="mbtiInputDesc">본인의 MBTI 유형을 알고 계신가요?</p>
            <input type="text" id="mbti-input" data-i18n-placeholder="mbtiPlaceholder" maxlength="4">
            <div class="navigation-buttons">
                 <button id="mbti-skip-btn" data-i18n-key="skipButton">건너뛰기</button>
                 <button id="mbti-submit-btn" data-i18n-key="nextButton">다음</button>
            </div>
            <button id="start-mbti-test-btn" class="text-button" data-i18n-key="mbtiUnknownButton">MBTI를 모른다면? 검사하기</button>
        </div>

        <!-- 5. MBTI 검사 -->
        <div id="mbti-test-screen" class="screen">
            <div id="mbti-progress-bar-container"><div id="mbti-progress-bar"></div></div>
            <p id="mbti-progress-text"></p>
            <h3 id="mbti-question-text"></h3>
            <div id="mbti-options-container">
                <div class="mbti-button-group"></div>
            </div>
            <div class="mbti-navigation">
                <button id="mbti-back-btn" class="mbti-back-button" style="display: none;">뒤로</button>
            </div>
        </div>

        <!-- 5.5. MBTI 결과 화면 (새로 추가) -->
        <div id="mbti-result-screen" class="screen">
            <h2 data-i18n-key="mbtiResultTitle">당신의 '음양 MBTI'는...</h2>
            <div id="mbti-result-display"></div>
            <p data-i18n-key="mbtiResultDesc" id="mbti-result-description"></p>
            <button id="proceed-to-cards-btn" data-i18n-key="nextButton">다음</button>
        </div>

        <!-- 6. 카드 선택 -->
        <div id="card-select-screen" class="screen">
            <div class="card-select-wrapper">
                <div class="instructions">
                    <h1 id="main-title" data-i18n-key="selectCards">4장의 카드를 선택하세요.</h1>
                    <p id="counter">4 cards left.</p>
                    <p id="shuffle-status" class="shuffle-status">카드를 섞는 중...</p>
                </div>
                
                <div class="card-container" id="card-container"></div>
                
                <div class="slots" id="slots">
                    <div class="slot" id="slot1"></div>
                    <div class="slot" id="slot2"></div>
                    <div class="slot" id="slot3"></div>
                    <div class="slot" id="slot4"></div>
                </div>
                
                <button id="reshuffle-btn" class="reshuffle-button" data-i18n-key="reshuffleButton">다시 셔플</button>
            </div>
        </div>
        
        <!-- 7. 통합 결과 화면 -->
        <div id="result-screen" class="screen">
            
            <div id="result-content-wrapper">
    <!-- 로딩 화면 -->
    <div id="loading-section">
        <div class="ripple-inward"></div>
        <div class="ripple-inward"></div>
        <div class="ripple-inward"></div>
        <div class="ripple-inward"></div>
        <div class="ripple-inward"></div>
        <div class="ripple-inward"></div>
    </div>

                <!-- 결과 표시 영역 (로딩 후 표시) -->
                <div id="result-sections" style="display: none;">
                    <section id="individual-cards-section" class="result-stage">
                        <!-- 제목과 버튼을 감싸는 새로운 div -->
                        <div class="stage-header">
                            <h2 id="card-stage-title" data-i18n-key="individualCardsTitle">개별 카드 해석</h2>
                            <!-- 기존 하단에 있던 버튼들을 이 안으로 옮김 -->
                            <div class="card-navigation-inline">
                                <button id="card-prev-btn" class="card-nav-btn left">이전</button>
                                <button id="card-next-btn" class="card-nav-btn right">다음</button>
                            </div>
                        </div>
                        <div class="result-content">
                            <div class="card-image-wrapper">
                                <img id="result-card-image" src="" alt="Selected Card">
                                <div id="card-overlay-text" class="card-overlay-text"></div>
                            </div>
                            <div id="keywords-area" class="keywords-area"></div>
                        </div>
                    </section>
                    <section id="summary-section" class="result-stage">
                        <h2 id="summary-stage-title" class="stage-title-red">카드 조합 총정리</h2>
                        <h2 id="summary-title"></h2>
                        <div id="summary-cards-display"></div>
                        <div id="summary-box">
                            <p id="summary-text"></p>
                            <div id="summary-keywords"></div>
                        </div>
                    </section>
                    <section id="action-plan-section" class="result-stage">
                        <h2 id="action-plan-title"></h2>
                        <div id="action-plan-container" class="action-phase-container">
                            <div id="action-plan-intro" class="action-phase-content"></div>
                            <div id="action-plan-phases" class="action-phase-content"></div>
                        </div>
                        <div id="action-plan-navigation" class="phase-navigation">
                            <button id="action-phase-prev" class="phase-nav-btn">이전</button>
                            <button id="action-phase-next" class="phase-nav-btn">다음 단계</button>
                        </div>
                    </section>
                    <div class="navigation-buttons stage-navigation">
                        <button id="prev-stage-btn" data-i18n-key="prevButton">이전</button>
                        <button id="next-stage-btn" data-i18n-key="actionPlanButton">AI 현실조언</button>
                    </div>
                    <!-- 하단 네비게이션 버튼들 -->
                    <div class="bottom-navigation">
                        <button id="pdf-save-btn" data-i18n-key="pdfSaveButton">PDF로 저장</button>
                        <button id="restart-btn" data-i18n-key="restartButton">처음으로</button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- 👇 모든 screen들 아래, app-container의 맨 끝에 이 블록을 추가! -->
        <div id="lock-overlay" style="display: none;">
            <div class="lock-box">
                <h3 data-i18n-key="lock.title">서비스 이용 제한</h3>
                <p id="lock-msg"></p>
                <!-- 힌트와 버튼은 완전히 제거 -->
            </div>
        </div>
    </div>
    
    <audio id="select-sound" src="sounds/card-select.wav"></audio>
    <audio id="shuffle-sound" src="sounds/card-shuffle.mp3"></audio>
    <audio id="button-sound" src="sounds/button-press.mp3"></audio>
    <audio id="typing-sound" src="sounds/typing.mp3"></audio>
    <audio id="handpan-sound" src="sounds/handpan.mp3"></audio>
    <audio id="handpan2-sound" src="sounds/handpan2.mp3" preload="auto" loop></audio>
    <audio id="cosmic-sound" src="sounds/cosmic.mp3" preload="auto" loop></audio>
    
    <script src="translation.js"></script>
    <script src="script.js"></script>
</body>
</html>